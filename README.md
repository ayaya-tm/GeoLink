# 🌿 LeafCast - 未来地表温度予測システム

**23年間の衛星観測データから未来の地表温度を予測し、緑化による温度抑制効果をシミュレーション**

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![Streamlit](https://img.shields.io/badge/Streamlit-1.28+-red.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)

---

## 📋 目次

- [概要](#概要)
- [主な機能](#主な機能)
- [技術スタック](#技術スタック)
- [セットアップ](#セットアップ)
- [使用方法](#使用方法)
- [データソース](#データソース)
- [プロジェクト構成](#プロジェクト構成)
- [予測モデルの詳細](#予測モデルの詳細)
- [注意事項](#注意事項)
- [今後の展望](#今後の展望)
- [ライセンス](#ライセンス)

---

## 🎯 概要

LeafCastは、JAXA（宇宙航空研究開発機構）とNASAの衛星データを活用し、地表面温度（LST）と植生指数（NDVI）の長期トレンドから未来を予測するWebアプリケーションです。都市計画、環境政策立案、ヒートアイランド対策などに活用できます。

### 🌟 特徴

- **📍 任意エリア選択**: 地図上で自由にエリアを選択可能
- **🛰️ リアルタイムデータ取得**: JAXA APIから最新の衛星データを取得
- **📊 長期トレンド分析**: 2002年から現在までの変化を可視化
- **🔮 最大20年先の予測**: 線形回帰モデルによる未来予測
- **🌳 緑化シミュレーション**: 植生増加による温度抑制効果の定量評価
- **📋 データ一覧表示**: 観測値と予測値を統合したテーブル
- **💻 直感的UI**: 専門知識不要の使いやすいインターフェース

---

## 🚀 主な機能

### 1. 📍 調査エリア選択
- インタラクティブな地図から任意のエリアを選択
- 選択エリアの衛星データを自動取得

### 2. 🛰️ 衛星データ可視化
- **LST（地表面温度）**: ヒートマップ表示
- **NDVI（植生指数）**: 植生分布の可視化
- スライダーで年次変化を確認

### 3. 📊 トレンド分析と予測
- 過去10年分の観測データから未来20年を予測
- 実測値と予測値を同時にグラフ表示
- LST・NDVI両指標の経年変化を追跡

### 4. 📋 詳細データ一覧
- **観測データのみ**: 実測値のテーブル表示
- **観測+予測データ**: 観測と予測を統合したテーブル（✅観測/🔮予測で識別）
- **統計情報**: 平均値、最大値、最小値、標準偏差

### 5. 🌳 緑化シミュレーション
- NDVIを1〜20%向上させた場合の温度変化を計算
- 緑化政策の効果を事前評価
- 具体的な温度低減量を数値で提示

---

## 🛠️ 技術スタック

### フロントエンド
- **Streamlit**: Webアプリケーションフレームワーク
- **Folium**: インタラクティブ地図表示
- **Matplotlib**: データ可視化

### データ処理
- **NumPy**: 数値計算
- **Pandas**: データフレーム操作
- **scikit-learn**: 機械学習（線形回帰）

### データソース
- **JAXA Earth API**: 衛星データ取得
- **MODIS**: NASA地球観測センサー

---

## 💻 セットアップ

### 必要要件

- Python 3.8以上
- pip（パッケージマネージャー）

### インストール手順

1. **リポジトリのクローン**
```bash
git clone https://github.com/yourusername/leafcast.git
cd leafcast
```

2. **依存パッケージのインストール**
```bash
bash setup_scripts/pip_install.sh
```

または手動でインストール:
```bash
pip install --upgrade pip
pip install streamlit folium streamlit-folium matplotlib pandas scikit-learn pillow numpy
pip install ./jaxaearth/jaxa-earth-0.1.3.zip
```

3. **アプリケーションの起動**
```bash
streamlit run app.py
```

4. **ブラウザでアクセス**
```
http://localhost:8501
```

---

## 📖 使用方法

### ステップ1: エリア選択
1. 地図を拡大・縮小・ドラッグして調査エリアを表示
2. 表示エリアが確定すると自動でデータ取得開始

### ステップ2: 衛星データ確認
1. スライダーで年次を選択
2. LSTとNDVIの分布を視覚的に確認

### ステップ3: トレンド分析
1. グラフで過去のトレンドと未来予測を確認
2. 実線（観測値）と破線（予測値）を比較

### ステップ4: データ確認
1. タブで「観測データのみ」「観測+予測」「統計情報」を切り替え
2. ✅マーク（観測値）と🔮マーク（予測値）で識別

### ステップ5: 緑化シミュレーション
1. 対象年を設定（例：2030年）
2. NDVI向上率を設定（例：5%）
3. 「シミュレーション実行」ボタンをクリック
4. 温度低減効果を確認

---

## 📊 データソース

### LST（地表面温度）
- **データセット**: NASA EOSDIS Terra MODIS MOD11C3-LST
- **パラメータ**: 日中の地表面温度（Kelvin → Celsius変換）
- **解像度**: 月次平均値
- **観測時期**: 2002年〜現在

### NDVI（植生指数）
- **データセット**: JAXA JASMES Terra/Aqua MODIS NDVI
- **パラメータ**: 正規化植生指数
- **解像度**: 月次平均値
- **観測時期**: 2002年〜現在

### 取得条件
- **対象月**: 毎年4月（春季）
- **空間解像度**: 20ピクセル/単位
- **データ形式**: GeoTIFF（ラスターデータ）

---

## 📁 プロジェクト構成

```
leafcast/
│
├── app.py                      # メインアプリケーション（Streamlit）
├── jaxa_api.py                 # JAXA APIデータ取得クラス
├── future_prefiction.py        # 予測モデルとシミュレーション
│
├── setup_scripts/
│   └── pip_install.sh          # 依存パッケージインストールスクリプト
│
├── jaxaearth/
│   └── jaxa-earth-0.1.3.zip    # JAXA Earth APIライブラリ
│
└── README.md                   # プロジェクト説明書
```

### ファイル詳細

#### `app.py`
- Streamlitベースのメインアプリケーション
- UI/UXの実装、データフロー制御
- セッション管理、グラフ描画
- **改善点**:
  - カスタムCSSで美しいレイアウト
  - タブ切り替えで情報を整理
  - 観測データと予測データを統合テーブルで表示

#### `jaxa_api.py`
- `JaxaDataProvider`クラス
  - `get_land_cover_images()`: LSTデータ取得
  - `get_ndvi_images()`: NDVIデータ取得
  - `get_data_array()`: 汎用データ取得メソッド

#### `future_prefiction.py`
- `create_future_prediction_graph()`: 予測グラフ生成
- `simulate_greening_effect()`: 緑化シミュレーション

---

## 🧮 予測モデルの詳細

### 線形回帰モデル

本システムでは、scikit-learnの線形回帰を使用しています。

#### 1. NDVI予測モデル

```
NDVI(t) = α × Year + β
```

- **α（傾き）**: 年あたりのNDVI変化率
- **β（切片）**: 基準年のNDVI値
- **学習方法**: 最小二乗法（Ordinary Least Squares）

#### 2. LST予測モデル

```
LST(t) = γ × NDVI(t) + δ
```

- **γ（傾き）**: NDVIあたりの温度変化率（℃/NDVI）
- **δ（切片）**: NDVI=0のときの理論温度
- **前提**: NDVIとLSTに線形相関があること

#### 3. 緑化シミュレーション

```
NDVI_sim = NDVI_base × (1 + 増加率)
LST_sim = γ × NDVI_sim + δ
ΔT = LST_sim - LST_base
```

### モデルの限界

⚠️ **注意事項**

1. **線形仮定**: 過去のトレンドが将来も継続すると仮定
2. **非線形変化**: 急激な都市開発、大規模災害などは考慮されない
3. **外部要因**: 気候変動、政策変更などの影響は反映されない
4. **空間的均質性**: エリア内の微小な差異は平均化される

💡 **推奨事項**
- 複数シナリオでの予測を比較
- 他の予測手法との併用
- 定期的なモデルの再学習と検証

---

## ⚠️ 注意事項

### データ取得に関して

1. **ネットワーク接続**: JAXA APIへのアクセスにはインターネット接続が必要
2. **取得時間**: エリアサイズによって数十秒〜数分かかる場合があります
3. **データ欠損**: 一部の年・エリアでデータが取得できない場合があります
4. **API制限**: JAXA APIの利用規約に従ってください

### 予測精度に関して

1. **あくまで推定値**: 実際の値とは異なる可能性があります
2. **短期予測優先**: 5年以内の予測が最も信頼性が高い
3. **トレンド依存**: 過去のトレンドが変化すると予測精度が低下
4. **用途限定**: 学術研究、政策立案の参考資料として活用

### システム要件

- **推奨ブラウザ**: Google Chrome、Firefox、Safari（最新版）
- **メモリ**: 最低4GB RAM（8GB以上推奨）
- **ストレージ**: 500MB以上の空き容量

---

## 🔮 今後の展望

### 短期（3ヶ月以内）
- [ ] 複数エリアの同時比較機能
- [ ] データのCSVエクスポート
- [ ] 季節別データ取得（現在は4月のみ）

### 中期（6ヶ月以内）
- [ ] 機械学習モデルの高度化（LSTM、XGBoostなど）
- [ ] 予測精度の評価指標表示
- [ ] モバイル対応の最適化

### 長期（1年以内）
- [ ] リアルタイム気象データとの統合
- [ ] 都市計画シミュレーション機能
- [ ] APIの公開（他システムとの連携）
- [ ] 多言語対応（英語、中国語など）

---

## 🤝 コントリビューション

プルリクエストを歓迎します！大きな変更の場合は、まずissueを開いて変更内容を議論してください。

### 開発ガイドライン

1. コードスタイル: PEP 8に準拠
2. コミットメッセージ: 明確で簡潔な説明
3. テスト: 新機能には必ずテストを追加

---

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

### データ利用規約

- JAXA衛星データ: [JAXA利用規約](https://earth.jaxa.jp/)に準拠
- NASA MODISデータ: パブリックドメイン

---

## 📞 お問い合わせ

質問、バグ報告、機能リクエストは[Issues](https://github.com/yourusername/leafcast/issues)からお願いします。

---

## 🙏 謝辞

- **JAXA（宇宙航空研究開発機構）**: 衛星データ提供
- **NASA**: MODISセンサーデータ提供
- **Streamlitコミュニティ**: フレームワーク開発

---

<div align="center">
  <p>🌍 地球環境の未来を、データで見える化する 🌿</p>
  <p>Made with ❤️ by LeafCast Team</p>
</div>
